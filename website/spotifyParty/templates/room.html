<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shared Playlist</title>
</head>
<body>
<h1>Websocket Test Env</h1>
<form id="form" method="post">
    {% csrf_token %}
    <input type="submit" value="Start Timer">
</form>
<p id="timer"></p>

<form id="votesysten" method="post">
    <button id="1" type="submit" onclick= "reply_click(this.id, this.innerText)">0</button>
    <button id="2" type="submit" onclick= "reply_click(this.id, this.innerText)">0</button>
    <button id="3" type="submit" onclick= "reply_click(this.id, this.innerText)">0</button>
    <button id="4" type="submit" onclick= "reply_click(this.id, this.innerText)">0</button>
</form>

{% block script %}
<script>

console.log(window.location);

 <!-- var section for button -->
var loc = window.location;
var formData = document.getElementById("form");
var voteSystem = document.getElementById('votesysten');
var btn_list = document.getElementsByTagName("Button");
var button_id;
var button_val;
let stop_the_count = false;
 <!-- var section for timer -->
let timer = document.getElementById("timer");
    timer.style.display = "block";
 <!--  -->

 <!-- Receiving ID and value of the clicked button -->
function reply_click(clicked_id, clicked_val) {
     button_id = clicked_id;
     button_val =  clicked_val;
}

 <!-- Websocket routing -->
var wsStart = 'ws://';
if(loc.protocol === 'https:') {
    wsStart = 'wss://';
}

var endpoint = wsStart + loc.host + loc.pathname;
var socket = new WebSocket(endpoint);

 <!-- Receiving Python Data -->
socket.onmessage = function(e)
{
        console.log(e);
     <!-- Data of type button -->
    if(e.data.includes("button")) {
        const from_json = JSON.parse(e.data)
        const update_btn = from_json["button"]
        const update_val = from_json["button_val"]
        document.getElementById(update_btn).innerText = update_val
        console.log(update_btn + " " + update_btn)
    }

    <!-- Data of type timer -->
    else {

        <!-- Reset timer and votes -->
        if(e.data === '0') {
            stop_the_count = false
            document.getElementById("timer").innerText = "Round complete. Starting new voting.";
            let i;
            for(i = 0; i < btn_list.length; i++)
            {
                btn_list[i].innerText = 0;
            }
            stop_the_count = false;
        }
        else { <!-- Update timer -->
           document.getElementById("timer").innerText = "Timer on: " + e.data
        }
    }
}

 <!-- Sending Data to Python -->
socket.onopen = function(e)
{
    console.log("open", e);
     <!-- Sending Data of type timer -->
    formData.addEventListener("submit", function (event)
    {
        event.preventDefault();
         <!-- Triggering new countdown -->
        socket.send("Timer")
    });

     <!-- Sending Data of type button -->
    voteSystem.addEventListener("submit", function (event)
    {
        event.preventDefault();
        if(stop_the_count === false) {
            <!-- check if user has voted -->
            stop_the_count = true
            socket.send(JSON.stringify({
                'button': button_id, button_val
            }));
        }
    })
}

socket.onerror = function(e)
{
    console.log("error", e);
}

socket.onclose = function(e)
{
    console.log("close", e);
}

</script>
{% endblock %}
</body>
</html>